(function(d){var b,a,c;a=typeof window!=="undefined"&&window!==null?window:global;c="ontouchstart" in a;a.BarRating=b=(function(){function e(){this.show=function(){var h=d(this.elem),j,g,i=this.options,f=c?"touchstart":"click";if(!h.data("barrating")){h.data("barrating",{currentRatingValue:h.val(),currentRatingText:d("option:selected",h).text(),originalRatingValue:h.val(),originalRatingText:d("option:selected",h).text()});j=d("<div />",{"class":"bar-rating"}).insertAfter(h);h.data("barrating").deselectable=(!h.find("option:first").val())?true:false;h.find("option").each(function(){var n,m,l,k;n=d(this).val();if(n){m=d(this).text();l=d("<a />",{href:"#","data-rating-value":n,"data-rating-text":m});k=d("<span />",{text:(i.showValues)?m:""});j.append(l.append(k))}});if(i.showSelectedRating){j.append(d("<div />",{text:"","class":"current-rating"}))}g=j.find("a");j.on("ratingchange",function(k,l,m){l=l?l:h.data("barrating").currentRatingValue;m=m?m:h.data("barrating").currentRatingText;h.find("option").attr("selected",false);h.find('option[value="'+l+'"]').attr("selected",true);if(i.showSelectedRating){d(this).find(".current-rating").text(m)}}).trigger("ratingchange");j.on("updaterating",function(k){d(this).find('a[data-rating-value="'+h.data("barrating").currentRatingValue+'"]').addClass("selected current").prevAll().addClass("selected")}).trigger("updaterating");if(c){g.on("click",function(k){k.preventDefault()})}g.on(f,function(k){var m=d(this),l,n;k.preventDefault();g.removeClass("active selected");m.addClass("selected").prevAll().addClass("selected");l=m.attr("data-rating-value");n=m.attr("data-rating-text");if(m.hasClass("current")&&h.data("barrating").deselectable){m.removeClass("selected current").prevAll().removeClass("selected current");l="",n=""}else{g.removeClass("current");m.addClass("current")}h.data("barrating").currentRatingValue=l;h.data("barrating").currentRatingText=n;j.trigger("ratingchange");i.onSelect.call(this,h.data("barrating").currentRatingValue,h.data("barrating").currentRatingText);return false});if(!c){g.on({mouseenter:function(){var k=d(this);g.removeClass("active selected");k.addClass("active").prevAll().addClass("active");j.trigger("ratingchange",[k.attr("data-rating-value"),k.attr("data-rating-text")])}});j.on({mouseleave:function(){g.removeClass("active");j.trigger("ratingchange").trigger("updaterating")}})}h.hide()}};this.clear=function(){var f=d(this.elem);var g=f.next(".bar-rating");if(g&&f.data("barrating")){g.find("a").removeClass("selected current");f.data("barrating").currentRatingValue=f.data("barrating").originalRatingValue;f.data("barrating").currentRatingText=f.data("barrating").originalRatingText;g.trigger("ratingchange").trigger("updaterating");this.options.onClear.call(this,f.data("barrating").currentRatingValue,f.data("barrating").currentRatingText)}};this.destroy=function(){var g=d(this.elem);var i=g.next(".bar-rating");if(i&&g.data("barrating")){var f=g.data("barrating").currentRatingValue;var h=g.data("barrating").currentRatingText;g.removeData("barrating");i.off().remove();g.show();this.options.onDestroy.call(this,f,h)}}}e.prototype.init=function(g,h){var f;f=this;f.elem=h;return f.options=d.extend({},d.fn.barrating.defaults,g)};return e})();d.fn.barrating=function(f,e){return this.each(function(){var g=new b();if(!d(this).is("select")){d.error("Sorry, this plugin only works with select fields.")}if(g.hasOwnProperty(f)){g.init(e,this);return g[f]()}else{if(typeof f==="object"||!f){e=f;g.init(e,this);return g.show()}else{d.error("Method "+f+" does not exist on jQuery.barrating")}}})};return d.fn.barrating.defaults={showValues:false,showSelectedRating:true,onSelect:function(e,f){},onClear:function(e,f){},onDestroy:function(e,f){}}})(jQuery);